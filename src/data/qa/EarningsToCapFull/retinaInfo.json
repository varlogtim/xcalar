{
    "tables": [
        {
            "name": "EndResult-Customer9",
            "columns": [
                {
                    "columnName": "marketcap::sid",
                    "headerAlias": "sid"
                },
                {
                    "columnName": "date__integer",
                    "headerAlias": "date__integer"
                },
                {
                    "columnName": "EarningsToCap",
                    "headerAlias": "EarningsToCap"
                },
                {
                    "columnName": "Earnings_Annual_USD",
                    "headerAlias": "Earnings_Annual_USD"
                },
                {
                    "columnName": "marketcap::value",
                    "headerAlias": "value"
                }
            ]
        }
    ],
    "udfs": [
        {
            "moduleName": "earningscap",
            "fileName": "udfs/earningscap.py",
            "udfType": "python"
        }
    ],
    "query": "load --url \"<pathToCustomer9Datasets>/earnings\" --format csv --size 0B  --name \"vhs.45435.earnings\" --fielddelim , --crlf --header;index --key \"xcalarRecordNum\" --dataset \".XcalarDS.vhs.45435.earnings\" --dsttable \"earnings#MK5\" --prefix earnings;map --eval \"int(earnings::SEC_ID, 10)\" --srctable \"earnings#MK5\" --fieldName \"SEC_ID_integer\" --dsttable \"earnings#MK6\";map --eval \"float(earnings::EARNINGS_12_MONTHS)\" --srctable \"earnings#MK6\" --fieldName \"EARNINGS_12_MONTHS_float\" --dsttable \"earnings#MK7\";map --eval \"int(earnings::RESULTS_CURRENCY_ID, 10)\" --srctable \"earnings#MK7\" --fieldName \"RESULTS_CURRENCY_ID_integer\" --dsttable \"earnings#MK8\";map --eval \"int(earnings::data_dt, 10)\" --srctable \"earnings#MK8\" --fieldName \"data_dt_integer\" --dsttable \"earnings#MK9\";map --eval \"int(earnings::publication_date, 10)\" --srctable \"earnings#MK9\" --fieldName \"publication_date_integer\" --dsttable \"earnings#MK10\";filter --srctable earnings#MK10 --eval \"exists(EARNINGS_12_MONTHS_float)\"  --dsttable \"earnings#MK11\";filter --srctable earnings#MK11 --eval \"ge(publication_date_integer, data_dt_integer)\"  --dsttable \"earnings#MK12\";map --eval \"concat(string(SEC_ID_integer), concat(\\\".Xc.\\\", concat(string(RESULTS_CURRENCY_ID_integer), concat(\\\".Xc.\\\", string(publication_date_integer)))))\" --srctable \"earnings#MK12\" --fieldName \"multiGroupBy19097\" --dsttable \"earnings#MK14\";index --key \"multiGroupBy19097\" --keyType 1  --srctable \"earnings#MK14\" --dsttable \"earnings.index#MK15\";groupBy --srctable \"earnings.index#MK15\" --eval \"maxInteger(data_dt_integer)\" --fieldName \"max_data_date\" --newKeyFieldName \"multiGroupBy19097\" --dsttable \"GroupMaxDataDate#MK13\" --nosample;map --eval \"int(cut(multiGroupBy19097, 1, \\\".Xc.\\\"))\" --srctable \"GroupMaxDataDate#MK13\" --fieldName \"SEC_ID_integer\" --dsttable \"GroupMaxDataDate#MK16\";map --eval \"int(cut(multiGroupBy19097, 2, \\\".Xc.\\\"))\" --srctable \"GroupMaxDataDate#MK16\" --fieldName \"RESULTS_CURRENCY_ID_integer\" --dsttable \"GroupMaxDataDate#MK17\";map --eval \"int(cut(multiGroupBy19097, 3, \\\".Xc.\\\"))\" --srctable \"GroupMaxDataDate#MK17\" --fieldName \"publication_date_integer\" --dsttable \"GroupMaxDataDate#MK18\";map --eval \"concat(string(SEC_ID_integer), concat(\\\".Xc.\\\", concat(string(RESULTS_CURRENCY_ID_integer), concat(\\\".Xc.\\\", concat(string(publication_date_integer), concat(\\\".Xc.\\\", string(max_data_date)))))))\" --srctable \"GroupMaxDataDate#MK18\" --fieldName \"rightJoinCol95811\" --dsttable \"GroupMaxDataDate#MK21\";map --eval \"concat(string(SEC_ID_integer), concat(\\\".Xc.\\\", concat(string(RESULTS_CURRENCY_ID_integer), concat(\\\".Xc.\\\", concat(string(publication_date_integer), concat(\\\".Xc.\\\", string(data_dt_integer)))))))\" --srctable \"earnings#MK12\" --fieldName \"leftJoinCol59996\" --dsttable \"earnings#MK20\";index --key \"rightJoinCol95811\" --keyType 1  --srctable \"GroupMaxDataDate#MK21\" --dsttable \"GroupMaxDataDate.index#MK23\";index --key \"leftJoinCol59996\" --keyType 1  --srctable \"earnings#MK20\" --dsttable \"earnings.index#MK22\";join --leftTable \"earnings.index#MK22\" --rightTable \"GroupMaxDataDate.index#MK23\" --joinType innerJoin  --joinTable \"EarningsMaxDataDate#MK19\" --collisionCheck --rightRenameMap SEC_ID_integer:SEC_ID_integer_291:1&RESULTS_CURRENCY_ID_integer:RESULTS_CURRENCY_ID_integer_291:1&publication_date_integer:publication_date_integer_291:1;map --eval \"string(publication_date_integer)\" --srctable \"EarningsMaxDataDate#MK19\" --fieldName \"pub_date_string\" --dsttable \"EarningsMaxDataDate#MK24\";index --key \"SEC_ID_integer\" --keyType 4  --srctable \"EarningsMaxDataDate#MK24\" --dsttable \"EarningsMaxDataDate.index#MK26\";groupBy --srctable \"EarningsMaxDataDate.index#MK26\" --eval \"listAgg(pub_date_string)\" --fieldName \"pub_dates\" --newKeyFieldName \"SEC_ID_integer\" --dsttable \"PubDateList#MK25\" --nosample;map --eval \"earningscap:sortDates(pub_dates)\" --srctable \"PubDateList#MK25\" --fieldName \"sorted_pub_dates\" --dsttable \"PubDateList#MK27\";map --eval \"substring(sorted_pub_dates, 0, 6)\" --srctable \"PubDateList#MK27\" --fieldName \"start_pub_date\" --dsttable \"PubDateList#MK28\";map --eval \"substring(sorted_pub_dates, -6, 0)\" --srctable \"PubDateList#MK28\" --fieldName \"end_pub_date\" --dsttable \"PubDateList#MK29\";load --url \"<pathToCustomer9Datasets>/global_imcap\" --format json --size 0B  --name \"vhs.48874.marketcap\" --apply \"earningscap:parseMcapComma\";map --eval \"int(start_pub_date, 10)\" --srctable \"PubDateList#MK29\" --fieldName \"start_pub_date_integer\" --dsttable \"PubDateList#MK30\";index --key \"xcalarRecordNum\" --dataset \".XcalarDS.vhs.48874.marketcap\" --dsttable \"marketcap#MK0\" --prefix marketcap;map --eval \"int(end_pub_date, 10)\" --srctable \"PubDateList#MK30\" --fieldName \"end_pub_date_integer\" --dsttable \"PubDateList#MK31\";index --key \"marketcap::sid\" --keyType 4  --srctable \"marketcap#MK0\" --dsttable \"marketcap.index#MK33\";join --leftTable \"marketcap.index#MK33\" --rightTable \"PubDateList#MK31\" --joinType innerJoin  --joinTable \"CapPubDates#MK32\" --collisionCheck;filter --srctable CapPubDates#MK32 --eval \"between(marketcap::date_, start_pub_date_integer, end_pub_date_integer)\"  --dsttable \"CapPubDates#MK34\";map --eval \"int(marketcap::date_, 10)\" --srctable \"CapPubDates#MK34\" --fieldName \"date__integer\" --dsttable \"CapPubDates#MK35\";load --url \"<pathToCustomer9Datasets>/global_fx.csv\" --format csv --size 0B  --name \"vhs.58278.global_fx\" --fielddelim , --crlf --header;map --eval \"earningscap:getNearestPubDate(date__integer, sorted_pub_dates, 5)\" --srctable \"CapPubDates#MK35\" --fieldName \"nearest_pub_date\" --dsttable \"CapPubDates#MK36\";index --key \"xcalarRecordNum\" --dataset \".XcalarDS.vhs.58278.global_fx\" --dsttable \"global_fx#MK1\" --prefix global_fx;map --eval \"concat(string(SEC_ID_integer), concat(\\\".Xc.\\\", string(pub_date_string)))\" --srctable \"EarningsMaxDataDate#MK24\" --fieldName \"rightJoinCol54441\" --dsttable \"EarningsMaxDataDate#MK40\";map --eval \"concat(string(marketcap::sid), concat(\\\".Xc.\\\", string(nearest_pub_date)))\" --srctable \"CapPubDates#MK36\" --fieldName \"leftJoinCol26765\" --dsttable \"CapPubDates#MK39\";map --eval \"int(global_fx::fx_id, 10)\" --srctable \"global_fx#MK1\" --fieldName \"fx_id_integer\" --dsttable \"global_fx#MK2\";index --key \"rightJoinCol54441\" --keyType 1  --srctable \"EarningsMaxDataDate#MK40\" --dsttable \"EarningsMaxDataDate.index#MK41\";index --key \"leftJoinCol26765\" --keyType 1  --srctable \"CapPubDates#MK39\" --dsttable \"CapPubDates.index#MK42\";map --eval \"int(global_fx::date_, 10)\" --srctable \"global_fx#MK2\" --fieldName \"date__integer\" --dsttable \"global_fx#MK3\";join --leftTable \"CapPubDates.index#MK42\" --rightTable \"EarningsMaxDataDate.index#MK41\" --joinType innerJoin  --joinTable \"EarningsCap#MK38\" --collisionCheck --leftRenameMap SEC_ID_integer:SEC_ID_integer_83:1;map --eval \"float(global_fx::fx_rate)\" --srctable \"global_fx#MK3\" --fieldName \"fx_rate_float\" --dsttable \"global_fx#MK4\";project --srctable \"EarningsCap#MK38\" --dsttable \"EarningsCap#MK43\" \"date__integer\" \"SEC_ID_integer\" \"EARNINGS_12_MONTHS_float\" \"RESULTS_CURRENCY_ID_integer\" \"earnings::SEC_ID\" \"earnings::EARNINGS_12_MONTHS\" \"earnings::RESULTS_CURRENCY_ID\" \"earnings::data_dt\" \"earnings::publication_date\" \"earnings::column5\" \"marketcap::fx_id\" \"marketcap::value\" \"marketcap::date_\" \"marketcap::sid\";map --eval \"concat(string(fx_id_integer), concat(\\\".Xc.\\\", string(date__integer)))\" --srctable \"global_fx#MK4\" --fieldName \"rightJoinCol60750\" --dsttable \"global_fx#MK46\";map --eval \"concat(string(RESULTS_CURRENCY_ID_integer), concat(\\\".Xc.\\\", string(date__integer)))\" --srctable \"EarningsCap#MK43\" --fieldName \"leftJoinCol58495\" --dsttable \"EarningsCap#MK45\";index --key \"rightJoinCol60750\" --keyType 1  --srctable \"global_fx#MK46\" --dsttable \"global_fx.index#MK47\";index --key \"leftJoinCol58495\" --keyType 1  --srctable \"EarningsCap#MK45\" --dsttable \"EarningsCap.index#MK48\";join --leftTable \"EarningsCap.index#MK48\" --rightTable \"global_fx.index#MK47\" --joinType innerJoin  --joinTable \"EarningsCapUSD#MK44\" --collisionCheck --leftRenameMap date__integer:date__integer_227:1;map --eval \"div(EARNINGS_12_MONTHS_float, fx_rate_float)\" --srctable \"EarningsCapUSD#MK44\" --fieldName \"Earnings_Annual_USD\" --dsttable \"EarningsCapUSD#MK50\";map --eval \"div(Earnings_Annual_USD, marketcap::value)\" --srctable \"EarningsCapUSD#MK50\" --fieldName \"EarningsToCap\" --dsttable \"EarningsCapUSD#MK51\";filter --srctable EarningsCapUSD#MK51 --eval \"ge(date__integer, 1)\"  --dsttable \"EndResult-Customer9\";",
    "xcalarVersion": "1.1.3-914-xcalardev-3e6c6c9c",
    "retinaVersion": 1
}
