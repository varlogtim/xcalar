#!/bin/bash

export PATH=/opt/xcalar/bin:$PATH

export LD_LIBRARY_PATH=/opt/xcalar/lib:/opt/xcalar/lib64:$XCE_USRNODE_LD_LIB_PATH:$LD_LIBRARY_PATH

if [ -n "$XLRDIR" ]; then
    export PATH="$XLRDIR"/bin:$PATH
fi

declare -a CGROUPS_V1_CONTROLLERS=("memory")

MIN_TOTAL_MEM="${XCE_XCMGMTD_MIN_TOTAL_MEM:-$XCE_MW_MIN_TOTAL_MEM}"
SOFT_MEM_PCT="${XCE_XCMGMTD_SOFT_MEM_PCT:-$XCE_MW_SOFT_MEM_PCT}"
MEM_PCT="${XCE_XCMGMTD_MEM_PCT:-$XCE_MW_MEM_PCT}"
SVC_CNT="${XCE_XCMGMTD_SVC_CNT:-$XCE_MW_SVC_CNT}"
SWAPPINESS="${XCE_XCMGMTD_SWAPPINESS:-$XCE_MW_SWAPPINESS}"
OOM_CONTROL="${XCE_XCMGMTD_OOM_CONTROL:-$XCE_MW_OOM_CONTROL}"
SYSD_UNIT_NAME="${XCE_XCMGMTD_UNIT}"

. cgroupMgmtUtils.sh

cgroupMode
cgroupMwSetup

exec xcmgmtd ${XCE_CONFIG}
